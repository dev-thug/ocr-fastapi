# 6. GPU→CPU 폴백/재시도 및 성능 튜닝

연관 문서: `docs/ocr-pipeline.md`, `docs/performance.md`

## 서브테스크

- [x] 6.1 예외 캡처 및 폴백 경로 구현 — `app/ocr/engine.py` try/except 폴백, stub 유지
- [ ] 6.2 재시도 정책 정의(횟수/백오프) — `tenacity` 도입 및 설정
- [x] 6.3 입력 리사이즈/배치 처리 옵션 — 단건 썸네일링(`app/main.py`), 배치 `/ocr/batch` 추가

## 승인 기준

- GPU 미가용/예외 상황에서도 요청 실패율 < 1%

## 구현 전략

- 실패 유형 분류(일시/영구) 후 `tenacity` 기반 지수 백오프 재시도
- 폴백 시 로깅에 장치 전환 기록(meta.device=CPU)
- 프리로드/리사이즈/FP16(가능 시) 옵션 토글로 p95 단축

## 리서치 요약

- 초기 워밍업(엔진 로드)로 콜드스타트 개선, p95 안정화에 기여
- 배치 크기와 이미지 리사이즈가 처리량/지연에 큰 영향 → 환경변수로 조정 가능하도록 설계
